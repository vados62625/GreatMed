@model IEnumerable<RequestedCall>
@{
    string strTitle = "Панель администратора";
    ViewBag.Title = strTitle;
}

<div class="pt-5">
    <div>
        <h3>Заказы звонков</h3>
        <div class="div-box">
        </div>
        @if (Model.Count() > 0)
        {
            <table class="table table-success table-striped table-hover">
                <thead>
                    <tr>
                        <th scope="col">Имя</th>
                        <th scope="col">Телефон</th>
                        <th scope="col">Обработан</th>
                        <th scope="col">Дата</th>
                        <th scope="col">Действия</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (RequestedCall entity in Model)
                    {
                        <tr>
                            <td>@(entity.Name ?? "Без имени")</td>
                            <td><a href="tel:@($"{entity.Phone}")">@($"{entity.Phone}")</a></td>
                            <td>
                            @if (entity.IsProcessed)
                            {
                                <span class="text-success">обработан</span>
                            }
                            else
                            {
                                <span class="text-danger">не обработан</span>
                            }
                            </td>
                            <td>@entity.DateTime</td>
                            <td>
                            <form class="p-0" id="form-processed-@entity.Id" asp-area="Admin" asp-controller="Calls" asp-action="MarkProcessed" method="post">
                                <input type="hidden" name="id" value="@entity.Id">
                                <button class="btn btn-info w-100 mb-2">Пометить как @(entity.IsProcessed ? "не" : "")обработанный</button>
                            </form>
                            <form class="p-0" id="form-@entity.Id" asp-area="Admin" asp-controller="Calls" asp-action="Delete" method="post">
                                <input type="hidden" name="id" value="@entity.Id">
                                <a class="btn btn-danger w-100" href="#" onclick="confirmDelete(document.getElementById('form-@entity.Id'));">Удалить</a>
                            </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <div class="alert-info">Заказанных звонков нет</div>
        }
    </div>
    <div class="div-box">
        <form asp-area="" asp-controller="Account" asp-action="Logout" method="post">
            <input class="btn btn-danger" type="submit" value="Выйти" />
        </form>
    </div>
</div>

<script>
    function confirmDelete(el) {
        if (confirm('Удалить запись?')) {
            el.submit();
        } else {
            return
        }
    }
    function confirmProcessed(el) {
        if (confirm('Пометить как обработанный?')) {
            el.submit();
        } else {
            return
        }
    }
</script>
